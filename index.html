<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeniusCraft Studio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <img src="logo.svg" alt="Logo GeniusCraft Studio" class="logo">
            <h1>GeniusCraft Studio</h1>
            <p>Criação de imagens de IA de elite</p>
        </header>

        <main>
            <textarea id="userInput" placeholder="Descreva sua ideia... Ex: um lobo com armadura neon"></textarea>

            <div class="styles-grid">
                <button class="style-button active" data-style="Fotorealista">Fotorealista</button>
                <button class="style-button" data-style="Arte Fantasia">Arte Fantasia</button>
                <button class="style-button" data-style="Anime">Anime</button>
                <button class="style-button" data-style="Modelo 3D">Modelo 3D</button>
                <button class="style-button" data-style="Cinematográfico">Cinematográfico</button>
                <button class="style-button" data-style="Cyberpunk">Cyberpunk</button>
                <button class="style-button" data-style="Arte em Pixel">Arte em Pixel</button>
            </div>

            <button id="generateButton">Gerar Imagem</button>

            <div id="resultArea" class="output-area hidden">
                <div id="loader" class="loader-container">
                    <div class="spinner"></div>
                    <p>Gerando sua obra de arte...</p>
                </div>

                <div id="imageContainer" class="hidden">
                    <img id="generatedImage" src="" alt="Imagem gerada por IA">
                </div>

                <textarea id="outputPrompt" readonly placeholder="Seu prompt profissional aparecerá aqui..."></textarea>
                <button id="copyButton">Copiar Prompt</button>
            </div>
        </main>
    </div>

    <!-- ========================= -->
    <!--     SCRIPT CORRIGIDO      -->
    <!-- ========================= -->

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const generateButton = document.getElementById('generateButton');
        const userInput = document.getElementById('userInput');
        const styleButtons = document.querySelectorAll('.style-button');
        const resultArea = document.getElementById('resultArea');
        const loader = document.getElementById('loader');
        const imageContainer = document.getElementById('imageContainer');
        const generatedImage = document.getElementById('generatedImage');
        const outputPrompt = document.getElementById('outputPrompt');
        const copyButton = document.getElementById('copyButton');

        let selectedStyle = 'Fotorealista';

        // Escolha dos estilos
        styleButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                styleButtons.forEach(btn => btn.classList.remove('active'));
                const clickedButton = event.currentTarget;
                clickedButton.classList.add('active');
                selectedStyle = clickedButton.dataset.style;
            });
        });

        // Botão de gerar
        generateButton.addEventListener('click', async () => {
            const userIdea = userInput.value.trim();
            if (!userIdea) return alert('Por favor, descreva sua ideia antes de gerar a imagem.');

            const professionalPrompt = masterpiece, best quality, ultra-detailed, ${selectedStyle} style, ${userIdea};
            outputPrompt.value = professionalPrompt;

            resultArea.classList.remove('hidden');
            loader.classList.remove('hidden');
            imageContainer.classList.add('hidden');

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: professionalPrompt })
                });

                // --- Correção obrigatória ---
                if (!response.ok) {
                    const errorBody = await response.json().catch(() => ({}));
                    throw new Error(errorBody.error || "Erro desconhecido no servidor.");
                }

                const data = await response.json();

                if (!data.imageUrl) {
                    throw new Error("O backend não retornou a URL da imagem.");
                }

                // * CORREÇÃO FINAL *
                generatedImage.src = data.imageUrl;

                loader.classList.add('hidden');
                imageContainer.classList.remove('hidden');

            } catch (error) {
                loader.classList.add('hidden');
                alert("Falha ao gerar imagem: " + error.message);
            }
        });

        // Copiar prompt
        copyButton.addEventListener('click', () => {
            outputPrompt.select();
            document.execCommand('copy');
            copyButton.textContent = 'Copiado!';
            setTimeout(() => { copyButton.textContent = 'Copiar Prompt'; }, 2000);
        });
    });
    </script>

</body>
</html>
